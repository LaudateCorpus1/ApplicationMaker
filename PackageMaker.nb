Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Title", ":", " ", "PackageMaker"}]}], " ", "*)"}], " ", "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Author", ":", " ", "jmlopez"}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Email", ":", " ", 
     RowBox[{"jmlopez", ".", 
      RowBox[{"rod", "@", "gmail"}], ".", "com"}]}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Summary", ":", " ", 
     RowBox[{
     "Provides", " ", "functions", " ", "to", " ", "create", " ", "a", " ", 
      "new", " ", "package", " ", "inside", " ", "an", " ", "application", 
      "\n", "\t\t\t ", "and", " ", "to", " ", "update", " ", "the", " ", 
      "application", " ", "init", " ", 
      RowBox[{"file", "."}]}]}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Context", ":", " ", "ApplicationMaker`PackageMaker`"}]}], " ", 
   "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Package", " ", 
     RowBox[{"version", ":", " ", "1.0"}]}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"History", ":", "  ", 
     RowBox[{"Version", " ", "1.0", " ", "July", " ", "10", " ", "2011"}]}]}],
    " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Mathematica", " ", 
     RowBox[{"version", ":", " ", 
      RowBox[{
      "8.0", " ", "for", " ", "Mac", " ", "OS", " ", "X", " ", "x86", " ", 
       RowBox[{"(", 
        RowBox[{"64", "-", "bit"}], ")"}], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"February", " ", "23"}], ",", " ", "2011"}], ")"}]}]}]}]}], 
   " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{":", 
    RowBox[{"Discussion", ":", " ", 
     RowBox[{
     "The", " ", "function", " ", "NewPackage", " ", "creates", " ", "a", " ",
       "new", " ", "notebook", " ", "to", " ", "help", " ", "you", " ", "\n", 
      "\t\t\t\t", "write", " ", "functions", " ", "for", " ", "the", " ", 
      RowBox[{"package", ".", " ", "The"}], " ", "function", " ", 
      "UpdateInit", "\n", "\t\t\t\t", "updates", " ", "the", " ", 
      "application", " ", "init", " ", 
      RowBox[{"file", "."}]}]}]}], " ", "*)"}]}]], "Code"],

Cell[CellGroupData[{

Cell["Initialization", "Section"],

Cell[CellGroupData[{

Cell["Public Context", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<ApplicationMaker`PackageMaker`\>\"", ",", " ", 
    RowBox[{"{", "\"\<ApplicationMaker`ApplicationMaker`\>\"", "}"}]}], "]"}],
   ";"}]], "Code"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Unprotect", "[", 
   RowBox[{"NewPackage", ",", " ", "UpdateInit"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"NewPackage", ",", " ", "UpdateInit"}], "]"}], ";"}]}], "Code"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Messages", "Subsection"],

Cell[CellGroupData[{

Cell["Usage Messages", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NewPackage", "::", "usage"}], " ", "=", " ", 
   "\[IndentingNewLine]", "\"\<NewPackage[\!\(\*
StyleBox[\"pkgName\", \"TI\"]\), \!\(\*
StyleBox[\"appName\", \"TI\"]\)] creates the notebook \!\(\*
StyleBox[\"pkgName\", \"TI\"]\)\!\(\*
StyleBox[\".\", \"TI\"]\)\!\(\*
StyleBox[\"nb\", \"TI\"]\) and its respective \!\(\*
StyleBox[\"m\", \"TI\"]\) file inside the application \!\(\*
StyleBox[\"appName\", \"TI\"]\).\>\""}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"UpdateInit", "::", "usage"}], " ", "=", "\[IndentingNewLine]", 
   "\"\<UpdateInit[\!\(\*
StyleBox[\"appName\", \"TI\"]\)] creates the init file for the application \!\
\(\*
StyleBox[\"appName\", \"TI\"]\).\>\""}], ";"}]], "Code"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Error Messages", "Subsubsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NewPackage", "::", "argerr"}], "=", "\[IndentingNewLine]", 
   "\"\<Strings specifying the package name and the application it belongs to \
were expected.\>\""}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NewPackage", "::", "nodir"}], " ", "=", "\[IndentingNewLine]", 
   "\"\<There is no application `1` in `2`. To create a new application use \
NewApplication\>\""}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NewPackage", "::", "pkgerr"}], " ", "=", " ", 
   "\[IndentingNewLine]", 
   "\"\<The package you are trying to create in the application `1` already \
exists. Click `2` to edit its contents.\>\""}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"UpdateInit", "::", "nodir"}], " ", "=", "\[IndentingNewLine]", 
   "\"\<There is no application `1` in `2`. To create a new application use \
NewApplication\>\""}], ";"}]], "Code"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Private Context", "Subsection"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Code"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Implementation", "Section"],

Cell[CellGroupData[{

Cell["NewPackage", "Subsubsection"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NewPackage", "[", "\n", "  ", 
    RowBox[{
    "pkgName_String", "\n", ",", " ", "appName_String", "\n", ",", " ", 
     RowBox[{"appsDir_String:", " ", "$ApplicationsDirectory"}]}], "]"}], " ",
    ":=", "\n", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"appNameDir", ",", " ", "pkgPath", ",", " ", "nb"}], "}"}], ",",
      "\n", "\n", 
     RowBox[{
      RowBox[{"appNameDir", " ", "=", " ", 
       RowBox[{"FileNameJoin", "@", 
        RowBox[{"{", 
         RowBox[{"appsDir", ",", " ", "appName"}], "}"}]}]}], ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"DirectoryQ", "@", "appNameDir"}]}], "\n", ",", "  ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"NewPackage", "::", "nodir"}], ",", " ", "appName", ",", 
           " ", "appsDir"}], "]"}], ";", " ", 
         RowBox[{"Return", "@", "$Failed"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"pkgPath", " ", "=", " ", 
       RowBox[{"FileNameJoin", "@", 
        RowBox[{"{", 
         RowBox[{"appNameDir", ",", " ", 
          RowBox[{"pkgName", " ", "<>", " ", "\"\<.nb\>\""}]}], "}"}]}]}], 
      ";", "\n", "\n", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FileExistsQ", "@", "pkgPath"}], "\n", ",", "  ", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{
           RowBox[{"NewPackage", "::", "pkgerr"}], ",", " ", "appName", ",", 
           " ", 
           RowBox[{"Hyperlink", "[", 
            RowBox[{"\"\<here\>\"", ",", " ", "pkgPath"}], "]"}]}], "]"}], 
         ";", " ", "\n", "   ", 
         RowBox[{"Return", "@", "$Failed"}]}]}], "]"}], ";", "\n", "\n", 
      RowBox[{"nb", " ", "=", " ", 
       RowBox[{"CreateDocument", "[", "]"}]}], ";", "\n", "\n", 
      RowBox[{"SetOptions", "[", 
       RowBox[{"nb", ",", " ", "\n", 
        RowBox[{"TaggingRules", "->", " ", "None"}], ",", "\n", 
        RowBox[{"AutoGeneratedPackage", "->", " ", "Automatic"}], ",", "\n", 
        RowBox[{"StyleDefinitions", "->", " ", 
         RowBox[{"Notebook", "[", "\n", 
          RowBox[{
           RowBox[{"{", "\n", 
            RowBox[{
             RowBox[{"Cell", "[", 
              RowBox[{"StyleData", "[", 
               RowBox[{"StyleDefinitions", "->", " ", "\"\<Default.nb\>\""}], 
               "]"}], "]"}], ",", "\n", 
             RowBox[{"Cell", "[", 
              RowBox[{
               RowBox[{"StyleData", "[", "\"\<Input\>\"", "]"}], ",", " ", 
               RowBox[{"InitializationCell", "->", " ", "True"}]}], "]"}]}], 
            "\n", "}"}], ",", "\n", 
           RowBox[{"Visible", "->", " ", "False"}], ",", "\n", 
           RowBox[{
           "StyleDefinitions", "->", " ", 
            "\"\<PrivateStylesheetFormatting.nb\>\""}]}], "\n", "]"}]}]}], 
       "\n", "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "\"\<(* :Title: \>\"", "<>", "pkgName", "<>", 
            "\"\< *) \n(* :Author: \>\"", "<>", "$UserName", "<>", 
            "\"\< *)\n(* :Summary: Summary goes here. *)\n(* :Context: \>\"", 
            "<>", "appName", "<>", "\"\<`\>\"", "<>", "pkgName", "<>", 
            "\"\<` *)\n(* :Package version: 1.0 *)\n(* :History:  Version 1.0 \
\>\"", "<>", 
            RowBox[{"DateString", "[", 
             RowBox[{"{", 
              RowBox[{
              "\"\<MonthName\>\"", ",", " ", "\"\< \>\"", ",", " ", 
               "\"\<Day\>\"", ",", " ", "\"\< \>\"", " ", ",", " ", 
               "\"\<Year\>\""}], "}"}], "]"}], "<>", 
            "\"\< *)\n(* :Mathematica version: \>\"", "<>", "$Version", "<>", 
            "\"\< *)\n(* :Discussion: Give more details here.*)\>\""}], " ", "//",
            " ", "StandardForm"}], ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}],
       ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "\"\<BeginPackage[\\\"\>\"", "<>", "appName", "<>", "\"\<`\>\"", "<>",
             "pkgName", "<>", "\"\<`\\\"];\>\""}], " ", "//", " ", 
           "StandardForm"}], ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", 
      "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Code Section (Call Unprotect and ClearAll): *)\>\"", " ", "//",
            " ", "StandardForm"}], ",", " ", "\"\<Input\>\""}], "]"}]}], 
       "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Usage Messages: *)\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Code Section: *)\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Input\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Error Messages: *)\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Code Section: *)\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Input\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<Begin[\\\"`Private`\\\"];\>\"", " ", "//", " ", 
           "StandardForm"}], ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", 
      "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Code Section: *)\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Input\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{"\"\<End[];\>\"", " ", "//", " ", "StandardForm"}], ",", 
          " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{
          "\"\<(* :Code Section (Call Protect): *)\>\"", " ", "//", " ", 
           "StandardForm"}], ",", " ", "\"\<Input\>\""}], "]"}]}], "]"}], ";",
       "\n", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"nb", ",", " ", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{"\"\<EndPackage[];\>\"", " ", "//", " ", "StandardForm"}], 
          ",", " ", "\"\<Code\>\""}], "]"}]}], "]"}], ";", "\n", 
      RowBox[{"NotebookSave", "[", 
       RowBox[{"nb", ",", " ", "pkgPath"}], "]"}], ";", "\n", 
      RowBox[{"Return", "@", "nb"}], ";"}]}], "]"}]}], "\n"}], "\n", 
 RowBox[{
  RowBox[{"NewPackage", "@", "args___"}], " ", ":=", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"Message", "[", 
     RowBox[{"NewPackage", "::", "argerr"}], "]"}], ";", " ", "$Failed"}], 
   ")"}]}]}], "Code"]
}, Closed]],

Cell[CellGroupData[{

Cell["UpdateInit", "Subsubsection"],

Cell["\<\
Blocking Get demands several hacks then for Export to work, this might be \
dependent on version of Mathematica so I resorted to a string-based Get. :-( 
(Blocking CompoundExpression breaks everything on an even bigger scale, in \
ver 8.0 at least.)\
\>", "Text"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UpdateInit", "[", 
   RowBox[{"appName_String", "\n", ",", " ", 
    RowBox[{"appsDir_String:", "$ApplicationsDirectory"}]}], "]"}], " ", ":=",
   "\n", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"appNameDir", " ", "=", " ", 
      RowBox[{"FileNameJoin", "@", 
       RowBox[{"{", 
        RowBox[{"appsDir", ",", " ", "appName"}], "}"}]}]}], "}"}], ",", "\n",
     "\n", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"!", 
        RowBox[{"DirectoryQ", "@", "appNameDir"}]}], "\n", ",", "  ", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{
          RowBox[{"UpdateInit", "::", "nodir"}], ",", " ", "appName", ",", 
          " ", "appsDir"}], "]"}], ";", " ", 
        RowBox[{"Return", "@", "$Failed"}]}]}], "]"}], ";", "\n", "\n", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"pkgNames", " ", "=", " ", 
         RowBox[{"FileBaseName", " ", "/@", " ", 
          RowBox[{"FileNames", "@", 
           RowBox[{"FileNameJoin", "@", 
            RowBox[{"{", 
             RowBox[{"appNameDir", ",", " ", "\"\<*.nb\>\""}], "}"}]}]}]}]}], 
        "}"}], "\n", ",", " ", 
       RowBox[{"Export", "[", 
        RowBox[{
         RowBox[{"FileNameJoin", "@", 
          RowBox[{"{", 
           RowBox[{
           "appNameDir", ",", " ", "\"\<Kernel\>\"", ",", " ", 
            "\"\<Init.m\>\""}], "}"}]}], "\n", "  ", ",", " ", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Fold", "[", 
              RowBox[{"StringReplace", ",", " ", "#", ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                 "\"\<\\\"|Get|\\\"\>\"", " ", "->", " ", "\"\<Get\>\""}], 
                 ",", " ", 
                 RowBox[{"EndOfString", "->", "\"\<;\>\""}]}], "}"}]}], "]"}],
              "&"}], " ", "@", "\n", "    ", 
            RowBox[{"ToString", "[", 
             RowBox[{"#", ",", " ", "InputForm"}], "]"}]}], " ", "&"}], " ", 
          "@", "\n", "    ", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Composition", "[", 
             RowBox[{"\"\<|Get|\>\"", ",", " ", 
              RowBox[{
               RowBox[{
               "appName", " ", "<>", " ", "\"\<`\>\"", " ", "<>", " ", "#", 
                " ", "<>", " ", "\"\<`\>\""}], " ", "&"}]}], "]"}], " ", "/@",
             " ", "pkgNames"}], ")"}]}], "\n", "  ", ",", " ", 
         "\"\<Text\>\""}], "]"}]}], "]"}], ";"}]}], "]"}]}]], "Code"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Finalization", "Section"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"End", "[", "]"}], ";"}], " ", 
  RowBox[{"(*", " ", "`Private`", " ", "*)"}]}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{"NewPackage", ",", " ", "UpdateInit"}], "]"}], ";"}]], "Code"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EndPackage", "[", "]"}], ";"}], " ", 
  RowBox[{"(*", " ", "`PackageMaker`", " ", "*)"}]}]], "Code"]
}, Closed]]
},
WindowSize->{714, 563},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
PrivateNotebookOptions->{"FileOutlineCache"->False},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb",
$CellContext`TrackCellChangeTimes -> False
]

